---
typora-root-url: ..
---

# 计算机系统漫游:rocket:

**计算机系统**是由硬件和系统软件组成的，它们共同工作来运行应用程序。系统的具体实现方式在不断变化，但内在概念没有改变——所有的计算机系统组件与功能都是相似的。

本次漫游，我们将通过跟踪 `hello` 程序的生命周期来进行——被程序员创建、到在系统上运行、到输出信息，最后终止。

```c
#include <stdio.h>

int main() {
    printf("Hello world!");
    return 0;
}
```



### 1.1 信息就是位+上下文

`hello` 程序的生命周期从一个源程序开始，源程序实际上是一个由0和1组成的位（比特）序列，每 8 个比特被称为一个**字节**。大部分现代计算机系统都使用 **ASCII** 标准来表示文本字符，这种方式让我们得以用一个唯一的单字节大小的整数值来表示每个字符，`hello.c`也不例外。这种表示方法说明了**一个基本思想——系统中所有信息都是由一串比特表示的，区分不同数据对象的唯一方法就是通过这些数据对象的上下文来判断。**



### 1.2 程序被其他程序翻译成不同的格式

`hello` 程序的生命周期始于一个高级C语言程序，但为了在系统上运行我们需要把这些人类易懂的 C 语句用其他程序翻译为一系列低级机器语言指令。这些指令按照**可执行目标程序**的格式打好包，并以二进制磁盘文件的形式存放。

翻译过程分为四个阶段，执行这四个阶段的程序（**预处理器**、**编译器**、**汇编器**和**链接器**）一起构成了**编译系统**。

![](/img/1.1.png)

- **预处理阶段** **预处理器**根据已字符 # 开头的命令修改原始的 C 程序（将读取到的头文件信息直接插入程序文本中，得到以 `.i` 结尾的另一个 C 程序）

- **编译阶段** **编译器**将 `hello.i` 翻译成文本文件 `hello.s`，它包含一个**汇编语言程序**。该程序包含函数 `main` 的定义：

  ```
  main:
  	subq	$8, %rsp
  	movl	$.LC0, %edi
  	call	puts
  	movl	$0, %eax
  	addq	$8, %rsp
  	ret
  ```

  *汇编语言非常有用！它为不同高级语言和不同编译器提供了通用的输出语句*

- **汇编阶段** **汇编器**将 `hello.s` 翻译成机器语言指令，把这些指令打包成一种叫做**可重定位目标程序**的格式，并将结果保存在一个二进制形式的目标文件 `hello.o` 中。

- **链接阶段**  `hello` 程序调用了标准 C 库中的 `printf` 函数，它存在于一个名为 `printf.o` 的单独的预编译好了的目标文件中，而这个文件由**链接器**合并到 `hello.o`程序中，最后得到 `hello` 文件。`hello` 文件是一个**可执行目标文件**，可以被加载到内存中由系统执行。